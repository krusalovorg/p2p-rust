<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LITE PEER 2 LITE NODE - Демо Децентрализованной Сети</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="http://212.109.220.163:8080/a42e06fb2c2b6cadd3e21f7a7d579e0dc205614bb57052598b59b5117b108760">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;700&family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0A0A0A;
            color: #E0E0E0;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        .font-jetbrains-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        .font-space-grotesk {
            font-family: 'Space Grotesk', sans-serif;
        }

        /* Новый анимированный фон */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(76, 0, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(0, 255, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(192, 126, 255, 0.1) 0%, transparent 50%);
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 0%;
            }
            50% {
                background-position: 100% 100%;
            }
            100% {
                background-position: 0% 0%;
            }
        }

        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            opacity: 0.05;
            z-index: 1;
            pointer-events: none;
        }

        /* Навигация */
        .nav-dots {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-dot:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.2);
        }

        .nav-dot.active {
            background: #C07EFF;
            box-shadow: 0 0 20px rgba(192, 126, 255, 0.5);
        }

        .nav-dot::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid rgba(192, 126, 255, 0.3);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .nav-dot:hover::after {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.2);
        }

        .nav-dot.active::after {
            opacity: 1;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.5;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.5;
            }
        }

        .content-overlay {
            position: relative;
            z-index: 2;
            width: 100%;
            max-width: 1400px;
            padding-left: 2rem;
            padding-right: 2rem;
            margin: 0 auto;
        }

        /* Обновляем стили для секций */
        .section {
            padding: 4rem 0;
            opacity: 1;
            transform: none;
            transition: all 0.6s ease;
            width: 100%;
        }

        .section.active {
            opacity: 1;
            transform: none;
            display: block;
        }

        /* Секции с полным экраном */
        .section-fullscreen {
            width: 100%;
            margin-top: 2rem;
        }

        .section-fullscreen.active {
            display: block;
        }

        /* Обычные секции */
        .section-normal {
            min-height: auto;
            margin: 2rem 0;
            width: 100%;
        }

        .section-normal.active {
            display: block;
        }

        .glassmorphism {
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glassmorphism:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.45);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .neon-accent-cyan {
            color: #00FFFF;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            transition: all 0.3s ease;
        }
        .neon-accent-purple {
            color: #C07EFF;
            text-shadow: 0 0 20px rgba(192, 126, 255, 0.5);
            transition: all 0.3s ease;
        }
        .neon-accent-green {
            color: #39FF14;
            text-shadow: 0 0 20px rgba(57, 255, 20, 0.5);
            transition: all 0.3s ease;
        }
        .neon-accent-yellow {
            color: #FFFF33;
            text-shadow: 0 0 20px rgba(255, 255, 51, 0.5);
            transition: all 0.3s ease;
        }
        .btn-action {
            background: linear-gradient(90deg, #8A2BE2, #4A00E0);
            border: none;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.4);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border-radius: 12px;
        }
        .btn-action::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        .btn-action:hover::before {
            left: 100%;
        }
        .btn-action:hover {
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.6);
            transform: translateY(-2px) scale(1.05);
        }
        .btn-action:disabled {
            background: #374151;
            box-shadow: none;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .feature-card {
            background: rgba(23, 30, 49, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border-radius: 16px;
        }
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transform: translateX(-100%);
            transition: 0.5s;
        }
        .feature-card:hover::before {
            transform: translateX(100%);
        }
        .feature-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gallery-item {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 16px;
            overflow: hidden;
        }
        .gallery-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.1);
        }
        .gallery-item img {
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
        }
        .gallery-item:hover img {
            transform: scale(1.05);
        }
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #00FFFF;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .gradient-text {
            background: linear-gradient(90deg, #00FFFF, #C07EFF, #39FF14);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: gradient 8s ease infinite;
            background-size: 200% 200%;
            font-weight: 800;
            letter-spacing: -0.02em;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .hover-glow {
            transition: all 0.3s ease;
        }
        .hover-glow:hover {
            text-shadow: 0 0 30px currentColor;
            transform: scale(1.05);
        }
        /* Custom scrollbar for peers list and gallery */
        #peers-list::-webkit-scrollbar, #gallery-grid::-webkit-scrollbar {
            width: 8px;
        }
        #peers-list::-webkit-scrollbar-track, #gallery-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        #peers-list::-webkit-scrollbar-thumb, #gallery-grid::-webkit-scrollbar-thumb {
            background: #4A00E0;
            border-radius: 10px;
        }
        #peers-list::-webkit-scrollbar-thumb:hover, #gallery-grid::-webkit-scrollbar-thumb:hover {
            background: #8A2BE2;
        }
        .upload-form input[type="file"]::file-selector-button {
            background: #4A00E0;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-form input[type="file"]::file-selector-button:hover {
            background: #8A2BE2;
            transform: scale(1.05);
        }
        .gallery-item img {
            aspect-ratio: 16 / 9;
            object-fit: cover;
            border-radius: 12px;
        }
        /* Новые стили для улучшения UI */
        .section-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 2rem;
            text-align: center;
            letter-spacing: -0.02em;
        }
        .info-card {
            padding: 1.5rem;
            border-radius: 16px;
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.45);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .status-badge.online {
            background: rgba(57, 255, 20, 0.2);
            color: #39FF14;
            border: 1px solid rgba(57, 255, 20, 0.3);
        }
        .status-badge.offline {
            background: rgba(255, 0, 0, 0.2);
            color: #FF4444;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        .network-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        .stat-card {
            padding: 1.5rem;
            border-radius: 16px;
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.45);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, #00FFFF, #C07EFF);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .stat-label {
            font-size: 0.875rem;
            color: #9CA3AF;
        }
        /* Анимации для элементов */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }
        .delay-400 { animation-delay: 0.4s; }
        .delay-500 { animation-delay: 0.5s; }

        @media (max-width: 768px) {
            .nav-dots {
                right: 1rem;
                gap: 0.5rem;
            }

            .nav-dot {
                width: 8px;
                height: 8px;
            }

            .nav-dot::after {
                width: 16px;
                height: 16px;
            }

            .content-overlay {
                padding-left: 1rem;
                padding-right: 1rem;
            }

            .section {
                padding: 2rem 0;
            }

            .glassmorphism {
                padding: 1rem !important;
            }

            .grid {
                gap: 1rem !important;
            }
        }

        @media (max-width: 768px) {
            html, body {
                padding: 0 !important;
                margin: 0 !important;
                width: 100vw !important;
                max-width: 100vw !important;
                overflow-x: hidden !important;
                box-sizing: border-box !important;
            }
            .content-overlay {
                padding-left: 0 !important;
                padding-right: 0 !important;
                width: 100vw !important;
                max-width: 100vw !important;
            }
            .section, .glassmorphism, .info-card, .feature-card, .gallery-item {
                width: 100vw !important;
                max-width: 100vw !important;
                box-sizing: border-box !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                padding: 0.5rem !important;
                border-radius: 12px !important;
            }
            .section-title, h1, .gradient-text {
                font-size: 1.2rem !important;
                word-break: break-word !important;
                white-space: normal !important;
                line-height: 1.2 !important;
                text-align: center !important;
            }
            .nav-dots {
                right: 0.2rem !important;
                gap: 0.2rem !important;
            }
            .nav-dot {
                width: 7px !important;
                height: 7px !important;
            }
            .grid, .network-stats {
                display: flex !important;
                flex-direction: column !important;
                gap: 0.7rem !important;
            }
            #connection-info .grid {
                grid-template-columns: 1fr !important;
            }
            .gallery-item img {
                height: 140px !important;
                min-height: 100px !important;
                max-width: 100% !important;
            }
            .btn-action {
                font-size: 1rem !important;
                padding: 0.7rem 1.2rem !important;
                border-radius: 10px !important;
            }
            footer, .footer {
                padding-left: 0 !important;
                padding-right: 0 !important;
                width: 100vw !important;
                max-width: 100vw !important;
                box-sizing: border-box !important;
            }
        }

        html, body {
            max-width: 100vw;
            overflow-x: hidden;
        }

        /* Обновляем стили для информации о пире */
        #connection-info {
            
        }

        #connection-info .grid {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        .info-card {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .turncate {
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 selection:bg-purple-500 selection:text-white">
    <div class="background-animation"></div>
    <div class="noise-overlay"></div>

    <div class="nav-dots">
        <div class="nav-dot active" data-section="welcome"></div>
        <div class="nav-dot" data-section="connection"></div>
        <div class="nav-dot" data-section="features"></div>
        <div class="nav-dot" data-section="upload"></div>
        <div class="nav-dot" data-section="gallery"></div>
        <div class="nav-dot" data-section="stats"></div>
    </div>

    <div class="content-overlay">
        <header class="section section-normal active" id="welcome">
            <div class="text-center">
                <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold tracking-tight font-space-grotesk">
                    <span class="gradient-text">🌐 Добро пожаловать в Децентрализованную Сеть</span>
                </h1>
                <p class="text-lg md:text-xl text-gray-400 mt-4">Работает на сети <strong class="hover-glow neon-accent-purple">LITE PEER 2 LITE NODE</strong> (lp2lp / lp2ln)</p>
            </div>
        </header>

        <main class="w-full">
            <section id="connection-info" class="section section-fullscreen glassmorphism p-6 md:p-8 rounded-xl shadow-2xl text-left">
                <h2 class="text-2xl font-semibold mb-6 neon-accent-purple">📍 Информация о подключении</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="info-card">
                        <p class="text-sm text-gray-400 mb-1">ID Ноды</p>
                        <p id="node-id" class="font-jetbrains-mono neon-accent-green text-lg turncate">Загрузка...</p>
                    </div>
                    <div class="info-card">
                        <p class="text-sm text-gray-400 mb-1">Тип хоста</p>
                        <p id="host-type" class="neon-accent-yellow text-lg">Загрузка...</p>
                    </div>
                    <div class="info-card">
                        <p class="text-sm text-gray-400 mb-1">Статус</p>
                        <p id="node-status" class="text-lg">Загрузка...</p>
                    </div>
                    <div class="info-card">
                        <p class="text-sm text-gray-400 mb-1">Тип соединения</p>
                        <p id="connection-type" class="text-blue-400 text-lg">Загрузка...</p>
                    </div>
                </div>
                <!-- <div class="text-center mt-6">
                    <button id="ping-neighbors-btn" class="btn-action text-white font-semibold py-3 px-8 rounded-lg text-lg">
                        🔄 Пинг соседей
                    </button>
                </div> -->
            </section>

            <section id="network-features" class="section section-fullscreen glassmorphism p-6 md:p-8 rounded-xl shadow-2xl text-left">
                <h2 class="section-title neon-accent-cyan">🚀 Преимущества сети LITE PEER 2 LITE NODE</h2>
                <p class="text-center text-gray-400 mb-8">На основе анализа кода, наша P2P сеть предлагает:</p>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
            </section>

            <section id="file-upload-section" class="section section-normal glassmorphism p-6 md:p-8 rounded-xl shadow-2xl text-left">
                <h2 class="section-title neon-accent-green">📤 Загрузить изображение в сеть</h2>
                <form id="upload-form" class="upload-form space-y-6">
                    <div class="info-card">
                        <label for="file-input" class="block text-sm font-medium text-gray-300 mb-2">Выберите файл:</label>
                        <input type="file" id="file-input" name="file-input" accept="image/*" required class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 focus:ring-offset-gray-800 rounded-md border border-gray-600 p-2.5">
                        <p class="mt-2 text-xs text-gray-500">Только изображения (JPG, PNG, GIF и т.д.). Максимальный размер: 10 МБ</p>
                    </div>
                    <button type="submit" id="upload-button" class="w-full btn-action text-white font-semibold py-3 px-6 rounded-lg text-lg flex items-center justify-center">
                        <span id="upload-button-text">Загрузить в сеть</span>
                        <div id="upload-spinner" class="loading-spinner ml-2 hidden"></div>
                    </button>
                </form>
                <div id="upload-status" class="mt-4 text-center"></div>
            </section>

            <section id="network-gallery" class="section section-normal glassmorphism p-6 md:p-8 rounded-xl shadow-2xl text-left">
                <h2 class="section-title neon-accent-yellow">🖼️ Галерея Сети</h2>
                <div id="gallery-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 max-h-[600px] overflow-y-auto pr-2">
                    <p class="text-gray-400 col-span-full text-center" id="gallery-loading-text">Загрузка изображений...</p>
                </div>
                <div class="text-center mt-6">
                    <button id="refresh-gallery-btn" class="btn-action text-white font-semibold py-2 px-6 rounded-lg text-sm">
                        🔄 Обновить галерею
                    </button>
                </div>
            </section>

            <section class="section section-normal glassmorphism p-6 md:p-8 rounded-xl shadow-2xl text-left">
                <h2 class="section-title neon-accent-purple">📊 Статистика сети</h2>
                <div class="network-stats">
                    <div class="stat-card">
                        <div class="stat-value">24/7</div>
                        <div class="stat-label">Доступность</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">P2P</div>
                        <div class="stat-label">Архитектура</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">∞</div>
                        <div class="stat-label">Масштабируемость</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">100%</div>
                        <div class="stat-label">Безопасность</div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="mt-12 md:mt-20 text-gray-400 text-sm w-full px-4 text-center">
            <p id="current-url" class="mb-2">Текущий URL/IP: <span class="font-jetbrains-mono text-gray-300">Загрузка...</span></p>
            <p class="text-teal-400">Этот сайт размещен в пиринговой сети <strong class="font-semibold">LITE PEER 2 LITE NODE (lp2lp / lp2ln)</strong>.</p>
            <p>Нет CDN. Нет облака. Только пиры.</p>
        </footer>
    </div>

    <!-- <div id="peers-modal" class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-md flex items-center justify-center p-4 hidden z-50">
        <div class="glassmorphism p-6 rounded-xl shadow-2xl w-full max-w-md border border-gray-700">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold neon-accent-purple">Ближайшие пиры</h3>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <div id="peers-list" class="space-y-3 max-h-72 overflow-y-auto pr-2">
                <p class="text-gray-400">Загрузка списка пиров...</p>
            </div>
        </div>
    </div> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // --- Three.js Animated Background ---
        let scene, camera, renderer, particles, lines;
        const particleCount = 150; // Увеличим количество частиц
        const maxDistance = 120; // Увеличим максимальное расстояние для связей

        function initThreeJS() {
            const canvas = document.getElementById('network-canvas');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 200;
            renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0);

            const particleGeometry = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const velocities = [];
            for (let i = 0; i < particleCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 400;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 400;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 100;
                velocities.push({ x: (Math.random() - 0.5) * 0.2, y: (Math.random() - 0.5) * 0.2, z: (Math.random() - 0.5) * 0.1 });
            }
            particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            particles = new THREE.Points(particleGeometry, new THREE.PointsMaterial({ 
                color: 0x00FFFF, 
                size: 3,
                transparent: true, 
                opacity: 0.8,
                sizeAttenuation: true
            }));
            scene.add(particles);
            particles.velocities = velocities;

            const lineGeometry = new THREE.BufferGeometry();
            const lineMaterial = new THREE.LineBasicMaterial({ 
                color: 0x6A0DAD, 
                transparent: true, 
                opacity: 0.4,
                linewidth: 1
            });
            lines = new THREE.LineSegments(lineGeometry, lineMaterial);
            scene.add(lines);

            window.addEventListener('resize', onWindowResize, false);
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            const positions = particles.geometry.attributes.position.array;
            const velocities = particles.velocities;
            
            // Обновляем позиции частиц
            for (let i = 0; i < particleCount; i++) {
                positions[i * 3] += velocities[i].x;
                positions[i * 3 + 1] += velocities[i].y;
                positions[i * 3 + 2] += velocities[i].z;

                // Отражение от границ
                if (positions[i * 3] > 200 || positions[i * 3] < -200) velocities[i].x *= -1;
                if (positions[i * 3 + 1] > 200 || positions[i * 3 + 1] < -200) velocities[i].y *= -1;
                if (positions[i * 3 + 2] > 50 || positions[i * 3 + 2] < -50) velocities[i].z *= -1;
            }
            particles.geometry.attributes.position.needsUpdate = true;

            // Обновляем линии между частицами
            const particlePositions = particles.geometry.attributes.position.array;
            const currentLinePositions = [];
            for (let i = 0; i < particleCount; i++) {
                for (let j = i + 1; j < particleCount; j++) {
                    const dx = particlePositions[i * 3] - particlePositions[j * 3];
                    const dy = particlePositions[i * 3 + 1] - particlePositions[j * 3 + 1];
                    const dz = particlePositions[i * 3 + 2] - particlePositions[j * 3 + 2];
                    const distance = Math.sqrt(dx * dx + dy * dy + dz * dz);
                    if (distance < maxDistance) {
                        currentLinePositions.push(particlePositions[i * 3], particlePositions[i * 3 + 1], particlePositions[i * 3 + 2]);
                        currentLinePositions.push(particlePositions[j * 3], particlePositions[j * 3 + 1], particlePositions[j * 3 + 2]);
                    }
                }
            }
            lines.geometry.setAttribute('position', new THREE.Float32BufferAttribute(currentLinePositions, 3));
            lines.geometry.attributes.position.needsUpdate = true;
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- DOM Elements ---
        const nodeIdEl = document.getElementById('node-id');
        const hostTypeEl = document.getElementById('host-type');
        const nodeStatusEl = document.getElementById('node-status');
        const connectionTypeEl = document.getElementById('connection-type');
        const currentUrlEl = document.getElementById('current-url').querySelector('span');
        
        const pingNeighborsBtn = document.getElementById('ping-neighbors-btn');
        const peersModal = document.getElementById('peers-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const peersListEl = document.getElementById('peers-list');

        const featuresContainer = document.getElementById('network-features').querySelector('.grid');
        const uploadForm = document.getElementById('upload-form');
        const fileInput = document.getElementById('file-input');
        const uploadButton = document.getElementById('upload-button');
        const uploadButtonText = document.getElementById('upload-button-text');
        const uploadSpinner = document.getElementById('upload-spinner');
        const uploadStatusEl = document.getElementById('upload-status');
        
        const galleryGridEl = document.getElementById('gallery-grid');
        const galleryLoadingTextEl = document.getElementById('gallery-loading-text');
        const refreshGalleryBtn = document.getElementById('refresh-gallery-btn');

        // --- Network Features Data ---
        const networkFeaturesData = [
            { title: "Архитектура и масштабируемость", items: [
                "Полностью децентрализованная P2P архитектура",
                "Поддержка множества параллельных соединений",
                "Симуляция сети с настраиваемым количеством узлов",
                "Асинхронные технологии (Tokio) для производительности"
            ]},
            { title: "Сетевая функциональность", items: [
                "STUN/TURN для обхода NAT",
                "Прямые туннели между пирами",
                "Резервное взаимодействие через сигнальный сервер",
                "Поддержка HTTP прокси"
            ]},
            { title: "Безопасность", items: [
                "Встроенная криптография (AES, ChaCha20Poly1305)",
                "ECDSA и ECDH для обмена ключами",
                "Уникальные идентификаторы пиров",
                "Шифрование данных при передаче"
            ]},
            { title: "Хранение данных", items: [
                "LevelDB для надежного хранения",
                "Фрагментация и распределенное хранение",
                "Отслеживание свободного места",
                "Обмен фрагментами файлов"
            ]},
            { title: "Управление соединениями", items: [
                "Умное управление (ConnectionManager)",
                "Поддержка разных типов соединений",
                "Автоматическое восстановление",
                "Кэширование информации о пирах"
            ]},
            { title: "Дополнительные возможности", items: [
                "Поддержка WebAssembly",
                "HTTP прокси для интеграции",
                "Система логирования",
                "Консольный интерфейс"
            ]}
        ];

        function displayNetworkFeatures() {
            featuresContainer.innerHTML = '';
            networkFeaturesData.forEach((category, index) => {
                const card = document.createElement('div');
                card.className = `feature-card p-6 rounded-lg shadow-lg animate-fade-in delay-${(index + 1) * 100}`;
                
                const titleEl = document.createElement('h3');
                titleEl.className = 'text-xl font-semibold mb-3 neon-accent-purple';
                titleEl.textContent = category.title;
                card.appendChild(titleEl);

                const listEl = document.createElement('ul');
                listEl.className = 'list-disc list-inside space-y-2 text-gray-300 text-sm';
                category.items.forEach(itemText => {
                    const listItem = document.createElement('li');
                    listItem.textContent = itemText;
                    listEl.appendChild(listItem);
                });
                card.appendChild(listEl);
                featuresContainer.appendChild(card);
            });
        }

        // --- API Interaction Functions ---
        const URL_BASE = `${window.location.protocol}//${window.location.hostname}:8081`;

        async function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const base64String = reader.result.split(',')[1];
                    resolve(base64String);
                };
                reader.onerror = error => reject(error);
            });
        }

        async function fetchCurrentNodeInfo() {
            try {
                const response = await fetch(`${URL_BASE}/api/info`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                return {
                    nodeId: data.node_id || 'N/A',
                    hostType: data.host_type || 'N/A',
                    status: data.status || 'N/A',
                    connectionType: data.connection_type || 'N/A'
                };
            } catch (error) {
                console.error("Ошибка при получении информации об узле:", error);
                return {
                    nodeId: 'Ошибка',
                    hostType: 'N/A',
                    status: 'OFFLINE',
                    connectionType: 'N/A'
                };
            }
        }
        
        async function fetchPeers() {
            try {
                const response = await fetch(`${URL_BASE}/api/packet`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        protocol: "TURN",
                        data: {
                            type: "get_peers"
                        }
                    })
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                return data.peers || [];
            } catch (error) {
                console.error("Ошибка при получении списка пиров:", error);
                return [];
            }
        }

        async function handleUploadFile(file) {
            const filename = file.name;
            console.log("[Frontend] Starting file upload:", filename, "Size:", file.size, "bytes");
            
            const contents = await fileToBase64(file);
            console.log("[Frontend] File converted to base64, length:", contents.length);

            const payload = {
                filename: filename,
                contents: contents,
                public: true,
                encrypted: false,
                compressed: false,
                auto_decompress: false,
                token: ""
            };

            uploadButton.disabled = true;
            uploadButtonText.textContent = 'Загрузка...';
            uploadSpinner.classList.remove('hidden');
            uploadStatusEl.textContent = '';

            try {
                const response = await fetch(`${URL_BASE}/api/upload`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: "Ошибка сервера" }));
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                return result;
            } catch (error) {
                console.error("[Frontend] Upload error:", error);
                throw error;
            } finally {
                uploadButton.disabled = false;
                uploadButtonText.textContent = 'Загрузить в сеть';
                uploadSpinner.classList.add('hidden');
            }
        }
        
        async function fetchUploadedFiles() {
            console.log("Запрос списка файлов...");
            galleryLoadingTextEl.textContent = 'Обновление галереи...';
            galleryGridEl.innerHTML = '';

            try {
                const response = await fetch(`${URL_BASE}/api/files`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const files = await response.json();
                console.log("Список файлов получен:", files);
                return files;
            } catch (error) {
                console.error("Ошибка при получении списка файлов:", error);
                galleryLoadingTextEl.textContent = 'Ошибка загрузки галереи.';
                return [];
            }
        }

        function getDirectFileUrl(fileHash) {
            return `${window.location.protocol}//${window.location.hostname}:8080/${fileHash}`;
        }

        // --- UI Update Functions ---
        function updateNodeInfoUI(data) {
            nodeIdEl.textContent = data.nodeId || 'N/A';
            hostTypeEl.textContent = data.hostType || 'N/A';
            nodeStatusEl.textContent = data.status || 'N/A';
            connectionTypeEl.textContent = data.connectionType || 'N/A';
            
            if (data.status === 'ONLINE') {
                nodeStatusEl.className = 'text-lg neon-accent-green';
            } else if (data.status === 'OFFLINE') {
                nodeStatusEl.className = 'text-lg text-red-500';
            } else {
                nodeStatusEl.className = 'text-lg text-yellow-400';
            }
        }

        function updatePeersUI(peers) {
            peersListEl.innerHTML = '';
            if (peers.length === 0) {
                peersListEl.innerHTML = '<p class="text-gray-400">Пиры не найдены.</p>';
                return;
            }
            peers.forEach(peer => {
                const peerDiv = document.createElement('div');
                peerDiv.className = 'p-3 rounded-md flex justify-between items-center bg-gray-700 bg-opacity-50 hover:bg-opacity-75 transition-all duration-300';
                
                const peerIdSpan = document.createElement('span');
                peerIdSpan.className = 'font-jetbrains-mono text-sm text-gray-200';
                peerIdSpan.textContent = peer.id;
                
                const peerStatusSpan = document.createElement('span');
                peerStatusSpan.className = `text-xs px-2 py-1 rounded-full ${peer.status === 'ONLINE' ? 'bg-green-500 text-green-100' : 'bg-red-500 text-red-100'}`;
                peerStatusSpan.textContent = `${peer.status} (${peer.latency || 'N/A'})`;
                
                peerDiv.appendChild(peerIdSpan);
                peerDiv.appendChild(peerStatusSpan);
                peersListEl.appendChild(peerDiv);
            });
        }

        function displayGallery(files) {
            galleryGridEl.innerHTML = '';
            if (!files || files.length === 0) {
                galleryLoadingTextEl.textContent = 'В галерее пока нет изображений. Загрузите первое!';
                galleryGridEl.appendChild(galleryLoadingTextEl);
                return;
            }
            galleryLoadingTextEl.classList.add('hidden');

            const imageFiles = files.filter(file => file.mime.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                galleryLoadingTextEl.textContent = 'В галерее пока нет изображений. Загрузите первое!';
                galleryGridEl.appendChild(galleryLoadingTextEl);
                return;
            }

            imageFiles.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = `gallery-item glassmorphism p-4 rounded-lg flex flex-col justify-between animate-fade-in delay-${(index % 5) * 100}`;

                const imgLink = document.createElement('a');
                imgLink.href = getDirectFileUrl(file.file_hash);
                imgLink.target = "_blank";

                const img = document.createElement('img');
                img.src = getDirectFileUrl(file.file_hash);
                img.alt = file.filename || 'Изображение';
                img.onerror = () => { 
                    console.error(`Ошибка загрузки изображения: ${file.file_hash}`);
                    img.src = `https://placehold.co/600x400/1A202C/E0E0E0?text=Error+Loading`; 
                };
                img.className = 'w-full h-48 object-cover rounded-md mb-3 shadow-md';
                imgLink.appendChild(img);

                const name = document.createElement('p');
                name.className = 'font-semibold text-sm text-gray-200 truncate mb-1';
                name.textContent = file.filename || 'Без имени';
                name.title = file.filename || 'Без имени';

                const hash = document.createElement('p');
                hash.className = 'text-xs text-gray-400 font-jetbrains-mono truncate mb-1';
                hash.textContent = `Hash: ${file.file_hash}`;
                hash.title = file.file_hash;

                const size = document.createElement('p');
                size.className = 'text-xs text-gray-500 mb-2';
                size.textContent = `Размер: ${(file.size / 1024).toFixed(2)} KB`;
                
                const publicStatus = document.createElement('p');
                publicStatus.className = `text-xs mb-3 ${file.public ? 'text-green-400' : 'text-yellow-400'}`;
                publicStatus.textContent = file.public ? '🔓 Публичный' : '🔒 Приватный';

                const copyLinkButton = document.createElement('button');
                copyLinkButton.textContent = '🔗 Копировать ссылку';
                copyLinkButton.className = 'w-full text-xs bg-purple-600 hover:bg-purple-700 text-white py-1.5 px-3 rounded-md transition-all duration-300';
                copyLinkButton.addEventListener('click', async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const urlToCopy = getDirectFileUrl(file.file_hash);
                    
                    // Функция для копирования через временный input
                    const fallbackCopy = (text) => {
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        textArea.style.position = 'fixed';
                        textArea.style.left = '-999999px';
                        textArea.style.top = '-999999px';
                        document.body.appendChild(textArea);
                        textArea.focus();
                        textArea.select();
                        
                        try {
                            document.execCommand('copy');
                            return true;
                        } catch (err) {
                            console.error('Ошибка при копировании:', err);
                            return false;
                        } finally {
                            document.body.removeChild(textArea);
                        }
                    };

                    try {
                        // Пробуем использовать Clipboard API
                        if (navigator.clipboard && navigator.clipboard.writeText) {
                            await navigator.clipboard.writeText(urlToCopy);
                        } else {
                            // Если Clipboard API недоступен, используем fallback
                            if (!fallbackCopy(urlToCopy)) {
                                throw new Error('Не удалось скопировать текст');
                            }
                        }
                        
                        const originalText = copyLinkButton.textContent;
                        copyLinkButton.textContent = '✓ Скопировано!';
                        copyLinkButton.classList.add('bg-green-600', 'hover:bg-green-700');
                        setTimeout(() => {
                            copyLinkButton.textContent = originalText;
                            copyLinkButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                            copyLinkButton.classList.add('bg-purple-600', 'hover:bg-purple-700');
                        }, 2000);
                    } catch (err) {
                        console.error('Не удалось скопировать ссылку: ', err);
                        copyLinkButton.textContent = '❌ Ошибка копирования';
                        setTimeout(() => {
                            copyLinkButton.textContent = '🔗 Копировать ссылку';
                        }, 2000);
                    }
                });

                item.appendChild(imgLink);
                item.appendChild(name);
                item.appendChild(hash);
                item.appendChild(size);
                item.appendChild(publicStatus);
                item.appendChild(copyLinkButton);
                galleryGridEl.appendChild(item);
            });
        }
        
        // --- Event Listeners ---
        if (pingNeighborsBtn) {
            pingNeighborsBtn.addEventListener('click', async () => {
                peersListEl.innerHTML = '<p class="text-gray-400 animate-pulse">Загрузка списка пиров...</p>';
                peersModal.classList.remove('hidden');
                const peers = await fetchPeers();
                updatePeersUI(peers);
            });
        }

        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', () => peersModal.classList.add('hidden'));
        }

        if (peersModal) {
            peersModal.addEventListener('click', (event) => {
                if (event.target === peersModal) peersModal.classList.add('hidden');
            });
        }

        if (uploadForm) {
            uploadForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                const file = fileInput.files[0];

                if (!file) {
                    uploadStatusEl.innerHTML = `<p class="text-red-400">Пожалуйста, выберите файл для загрузки.</p>`;
                    return;
                }

                // Проверка размера файла (10 МБ = 10 * 1024 * 1024 байт)
                const maxSize = 10 * 1024 * 1024;
                if (file.size > maxSize) {
                    uploadStatusEl.innerHTML = `<p class="text-red-400">Размер файла превышает 10 МБ. Пожалуйста, выберите файл меньшего размера.</p>`;
                    return;
                }

                try {
                    const result = await handleUploadFile(file);
                    uploadStatusEl.innerHTML = `
                        <div class="bg-green-500 bg-opacity-20 p-4 rounded-lg">
                            <p class="text-green-400">Файл "${file.name}" успешно загружен!</p>
                            <p class="text-sm text-gray-300 mt-2">Hash: <span class="font-jetbrains-mono">${result.file_hash}</span></p>
                            <p class="text-sm text-gray-400 mt-1">Ссылка: <a href="${getDirectFileUrl(result.file_hash)}" target="_blank" class="text-purple-400 hover:underline">${getDirectFileUrl(result.file_hash)}</a></p>
                        </div>`;
                    uploadForm.reset();
                    await loadGallery();
                } catch (error) {
                    uploadStatusEl.innerHTML = `
                        <div class="bg-red-500 bg-opacity-20 p-4 rounded-lg">
                            <p class="text-red-400">Ошибка загрузки: ${error.message || 'Неизвестная ошибка'}</p>
                        </div>`;
                }
            });
        }

        if (refreshGalleryBtn) {
            refreshGalleryBtn.addEventListener('click', loadGallery);
        }

        async function loadGallery() {
            galleryLoadingTextEl.classList.remove('hidden');
            galleryLoadingTextEl.textContent = 'Обновление галереи...';
            galleryGridEl.innerHTML = '';
            const files = await fetchUploadedFiles();
            displayGallery(files);
        }
        loadGallery();
        
        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initThreeJS();
            displayNetworkFeatures();

            fetchCurrentNodeInfo().then(updateNodeInfoUI).catch(error => {
                console.error("Не удалось загрузить информацию об узле:", error);
                updateNodeInfoUI({ nodeId: 'Ошибка', hostType: 'N/A', status: 'OFFLINE', connectionType: 'N/A' });
            });

            try {
                currentUrlEl.textContent = window.location.href;
            } catch (e) {
                currentUrlEl.textContent = "Не удалось определить URL";
            }
            
            loadGallery();
        });
        
        fetchCurrentNodeInfo().then(updateNodeInfoUI).catch(error => {
            console.error("Не удалось загрузить информацию об узле:", error);
            updateNodeInfoUI({ nodeId: 'Ошибка', hostType: 'N/A', status: 'OFFLINE', connectionType: 'N/A' });
        });

        // Обновляем код навигации
        document.addEventListener('DOMContentLoaded', () => {
            const sections = document.querySelectorAll('.section');
            const dots = document.querySelectorAll('.nav-dot');
            
            if (sections.length === 0 || dots.length === 0) {
                console.warn('Навигационные элементы не найдены');
                return;
            }

            let currentSection = 0;

            // Функция для обновления активной секции
            function updateActiveSection(index) {
                dots.forEach(dot => dot.classList.remove('active'));
                dots[index].classList.add('active');
                currentSection = index;
            }

            // Обработчики для точек навигации
            dots.forEach((dot, index) => {
                dot.addEventListener('click', () => {
                    updateActiveSection(index);
                    sections[index].scrollIntoView({ behavior: 'smooth' });
                });
            });

            // Следим за прокруткой для обновления активной точки
            window.addEventListener('scroll', () => {
                const scrollPosition = window.scrollY;
                sections.forEach((section, index) => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.offsetHeight;
                    if (scrollPosition >= sectionTop - sectionHeight / 3 && 
                        scrollPosition < sectionTop + sectionHeight / 3) {
                        updateActiveSection(index);
                    }
                });
            });
        });
    </script>
</body>
</html>
